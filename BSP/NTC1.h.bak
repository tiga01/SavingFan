

//NTC的ad值对应表
static u16 NTCTAB[241]= {
0xE7A,0xE70,0xE65,0xE5B,0xE50,0xE45,0xE3A,0xE2E,0xE23,0xE17,
0xE0B,0xDFF,0xDF2,0xDE5,0xDD8,0xDCB,0xDBE,0xDB0,0xDA3,0xD95,
0xD86,0xD78,0xD69,0xD5A,0xD4B,0xD3C,0xD2C,0xD1C,0xD0C,0xCFC,
0xCEB,0xCDB,0xCCA,0xCB9,0xCA7,0xC96,0xC84,0xC72,0xC60,0xC4E,
0xC3B,0xC28,0xC15,0xC02,0xBEF,0xBDB,0xBC8,0xBB4,0xBA0,0xB8C,
0xB77,0xB63,0xB4E,0xB39,0xB24,0xB0F,0xAFA,0xAE5,0xACF,0xABA,
0xAA4,0xA8E,0xA78,0xA62,0xA4C,0xA36,0xA1F,0xA09,0x9F2,0x9DC,
0x9C5,0x9AF,0x998,0x981,0x96B,0x954,0x93D,0x926,0x910,0x8F9,
0x8E2,0x8CB,0x8B4,0x89D,0x887,0x870,0x859,0x843,0x82C,0x815,
0x7FF,0x7E9,0x7D2,0x7BC,0x7A6,0x790,0x77A,0x764,0x74E,0x738,
0x722,0x70D,0x6F7,0x6E2,0x6CD,0x6B8,0x6A3,0x68E,0x679,0x665,
0x650,0x63C,0x628,0x614,0x600,0x5ED,0x5D9,0x5C6,0x5B3,0x5A0,
0x58D,0x57A,0x568,0x555,0x543,0x531,0x51F,0x50E,0x4FC,0x4EB,
0x4DA,0x4C9,0x4B8,0x4A8,0x497,0x487,0x477,0x467,0x457,0x448,
0x439,0x429,0x41A,0x40C,0x3FD,0x3EF,0x3E0,0x3D2,0x3C4,0x3B7,
0x3A9,0x39C,0x38E,0x381,0x374,0x368,0x35B,0x34F,0x343,0x337,
0x32B,0x31F,0x313,0x308,0x2FD,0x2F1,0x2E7,0x2DC,0x2D1,0x2C7,
0x2BC,0x2B2,0x2A8,0x29E,0x294,0x28B,0x281,0x278,0x26F,0x265,
0x25C,0x254,0x24B,0x242,0x23A,0x232,0x229,0x221,0x219,0x212,
0x20A,0x202,0x1FB,0x1F3,0x1EC,0x1E5,0x1DE,0x1D7,0x1D0,0x1C9,
0x1C3,0x1BC,0x1B6,0x1AF,0x1A9,0x1A3,0x19D,0x197,0x191,0x18B,
0x186,0x180,0x17A,0x175,0x170,0x16A,0x165,0x160,0x15B,0x156,
0x151,0x14D,0x148,0x143,0x13F,0x13A,0x136,0x131,0x12D,0x129,
0x125,0x120,0x11C,0x118,0x114,0x111,0x10D,0x109,0x105,0x102,
0xFE };

//查表函数
u8 look_up_table(u16 *a,u8 ArrayLong,u16 data)  	//data：ADC的值
{
    u16 begin,end,middle ;
    u8 i ;
    begin = 0 ;
    end = ArrayLong-1 ;
    i = 0  ;
    if(data >= a[begin]) return begin ;
    else if(data <= a[end]) return end ;
    while(begin < end)
    {
            middle = (begin+end)/2 ;
            if(data == a[middle] ) break ;
            if(data < a[middle] && data > a[middle+1]) break ;
            if(data > a[middle])  end = middle ;
            else begin = middle ;
            if(i++ > ArrayLong) break ;
    }
    if(begin > end ) return 0 ;
    return middle ;		//查表后得到数组的下标[middle]
}

//输入表的序号值，得到温度值
float num_to_temperature(u8 num)
{
    float  data;
    data = 0.5*num-20;	//根据下标得到对应的温度值
    return data;				//得到温度的值
}

    if( (data<=NTCTAB[0]) && (data>NTCTAB[240]) )
    {
        num=look_up_table(NTCTAB,241,data);
        t1=num_to_temperature(num);
        tx=0.5*(data-NTCTAB[num])/(NTCTAB[num+1]-NTCTAB[num])+t1;
        printf("temp_ntc:%4.2f\r\n",tx);		//0.1%的误差
    }
